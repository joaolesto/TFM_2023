<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/estiloAE.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="js/validator.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troços correntes de Autoestrada (AE)</title>
</head>
<h1>Troços correntes da Autoestrada (AE)</h1>
<body>
    <div class="parent">
        <div class="form-input-gerais">
            <form name="input" id="input_geral" class="form" method="post">
                <fieldset>
                  <legend>Inputs Gerais</legend>
                    <input type="radio" name="terreno" id="ondulado" />
                    <label for="ondulado">Terreno Ondulado</label>
                    <br/>
                    <input type="radio" name="terreno" id="plano" />
                    <label for="plano">Terreno Plano</label>
                    <br/>
                    <input type="radio" name="terreno" id="montanhoso" />
                    <label for="montanhoso">Terreno Montanhoso</label>
                    <br/>
                    <div class="general-inputs">
                        <div class="row">
                            <label for="car_volume">Volume de tráfego (pc/h)</label>
                            <input type="number" name="car_volume" id="car_volume" min="0" number-only />
                        </div>
                        <div class="row">
                            <label for="phf">Fator de Ponta Horário</label>
                            <input type="number" name="phf" id="phf" step="0.01" min="0.80" max="0.95" />
                        </div>
                        <div class="row">
                            <label for="N_vias">Número de Vias</label>
                            <input type="number" name="N_vias" id="N_vias" min="2" max="10" step="1" number-only/>
                        </div>
                        <div class="row">
                            <label for="pt">% de Veiculos Pesados</label>
                            <input type="number" name="pt" id="pt" min="0" max="100"/>
                        </div>
                        <div class="row">
                            <label for="pr">% de Veiculos Recriativos</label>
                            <input type="number" name="pr" id="pr" min="0" max="100"/>
                        </div>
                        <div class="row"> 
                            <label for="FFS">Velocidade de fluxo livre (km/h)</label>
                            <input type="number" name="FFS_m" id="FFS" min="0"/>
                        </div>
                        <input type="radio" name="FFS" id="FFS_c"/>
                        <label for="FFS_c">Calculado</label>
                        <input type="radio" name="FFS" id="FFS_m"/>
                        <label for="FFS_m">Medido em campo</label>
                    </div>
                    <div class="row">
                        <label for="berma">Largura da Berma (m)</label>
                        <input type="number" name="berma" id="berma" step ="0.01" min="0"/>
                    </div>
                    <div class="row">
                           <label for="via">Largura da Via (m)</label>
                    <input type="number" name="via" id="via" step ="0.01" min="3.0"/>
                    </div>
                    <div class="row">
                        <label for="length">Comprimento da Via (km)</label>
                        <input type="number" name="length" id="length" step ="0.01" min="0" max="100" />
                    </div>
                    <div class="row">
                        <label for="N_acessos">Número de Acessos</label>
                        <input type="number" name="acessos" id="N_acessos" min="0" />
                    </div>
                    <div class="row">
                        <label for="BFFS">Velocidade base em regime livre (km/h)</label>
                        <input type="number" name="BFFS" id="BFFS" min="45"/>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="form-hcm-2000">
            <form name="input" id="input_HCM2000" class="form" method="post">
                <fieldset>
                    <legend>Inputs HCM 2000</legend>
                    <div class="row">
                        <label for="tipos_de_condutores">Tipos de Condutores</label>
                        <select id= "tipos_de_condutores" name="tipos_de_condutores">
                            <option value="">Select Option</option>
                            <option>Condutores Habituais</option>
                            <option>Condutores Exporádicos</option>
                        </select>
                    </div>
                </fieldset>
            </form>
            <button type="submit" id="Calcular">Calcular</button>
        </div>
        <div class="form-outputs">
            <form name="outputs" id="outputs" class="form" action="php/validation.php" method="post">
                <table id="tabela">
                    <thead>
                        <tr>
                            <th>Outputs</th>
                            <th>HCM 2000</th>
                            <th>HCM 7ª edição</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="label_fhv">FHV</td>
                            <input type="hidden" name="label_fhv">
                            <td><input type="text" name="fhv" id="fhv" disabled></td>
                            <input type="hidden" name="fhv">
                            <td><input type="text" name="fhv_2022" id="fhv_2022" disabled></td>
                            <input type="hidden" name="fhv_2022">
                        </tr>
                        <tr>
                            <td id="label_vp">Vp (uvl/h/via)</td>
                            <input type="hidden" name="label_vp">
                            <td><input type="text" name="vp" id="vp" disabled></td>
                            <input type="hidden" name="vp">
                            <td><input type="text" name="vp_2022" id="vp_2022" disabled></td>
                            <input type="hidden" name="vp_2022">
                        </tr>
                        <tr>
                            <td id="label_ffs">Velocidade de fluxo livre (km/h)</td>
                            <input type="hidden" name="label_ffs">
                            <td><input type="text" name="ffs_o" id="FFS_o" disabled></td>
                            <input type="hidden" name="FFS_o">
                            <td><input type="text" name="ffs_o_2022" id="FFS_o_2022" disabled></td>
                            <input type="hidden" name="FFS_o_2022">
                        </tr>
                        <tr>
                            <td  id="label_capacidade">Capacidade (uvl/h/via)</td>
                            <input type="hidden" name="label_capacidade">
                            <td><input type="text" name="capacidade" id="c" disabled></td>
                            <input type="hidden" name="c">
                            <td><input type="text" name="capacidade_2022" id="c_2022" disabled></td>
                            <input type="hidden" name="c_2022">
                        </tr>
                        <tr>
                            <td id="label_velocidade_media">Velocidade média (km/h)</td>
                            <input type="hidden" name="label_velocidade_media">
                            <td><input type="text" name="velocidade_media" id="S" disabled></td>
                            <input type="hidden" name="S">
                            <td><input type="text" name="velocidade_media_2022" id="S_2022" disabled></td>
                            <input type="hidden" name="S_2022">
                        </tr>
                        <tr>
                            <td id="label_densidade">Densidade de tráfego por via (uvl/km/via)</td>
                            <input type="hidden" name="label_densidade">
                            <td><input type="text" name="densidade" id="D" disabled></td>
                            <input type="hidden" name="D">
                            <td><input type="text" name="densidade_2022" id="D_2022" disabled></td>
                            <input type="hidden" name="D_2022">
                        </tr>
                        <tr>
                            <td id="label_service_level">Nivel de Serviço</td>
                            <input type="hidden" name="label_service_level">
                            <td><input type="text" name="service_level" id="service_level" disabled></td>
                            <input type="hidden" name="service_level">
                            <td><input type="text" name="service_level_2022" id="service_level_2022" disabled></td>
                            <input type="hidden" name="service_level_2022">
                        </tr>
                    </tbody>
                </table>
            </form>
         </div>
        <div class="form-hcm-7-edition">
            <form name="input" id="input_HCM7" class="form" method="post">
                <fieldset>
                    <legend>Inputs HCM 7ª Edição</legend>
                    <div class="row">
                        <label for="cond_atmos">Condições Atmosféricas</label>
                        <select id="cond_atmos" name="Condições_base">
                            <option value="">Select Option</option>
                            <option>Situação de Base</option>
                            <option>Precipitação Média</option>
                            <option>Precipitação Elevada</option>
                            <option>Pouca Neve</option>
                            <option>Neve Ligeira</option>
                            <option>Muita Neve</option>
                            <option>Nevão</option>
                            <option>Frio Severo</option>
                            <option>Pouca visibilidade</option>
                            <option>Péssima Visibilidade</option>
                            <option>Visibilidade Minima</option>
                        </select>
                    </div>
                </fieldset>
            </form>
            <button type="submit" id="Exportar" form="outputs">Exportar</button>
        </div>
    </div>  
</body>
  <script type="text/javascript">
    $(function () {
        $("#FFS_m").click(function () {
            if ($(this).is(":checked")) {
                $("#FFS").attr("disabled", false);
                $("#length").attr("disabled",true);
                $("#via").attr("disabled",true);
                $("#berma").attr("disabled",true);
                $("#BFFS").attr("disabled",true);
                $("#N_acessos").attr("disabled",true)
            }
        });
    });
    $(function () {
        $("#FFS_c").click(function () {
            if ($(this).is(":checked")) {
                $("#FFS").attr("disabled", true);
                $("#length").attr("disabled",false);
                $("#berma").attr("disabled",false);
                $("#via").attr("disabled",false);
                $("#BFFS").attr("disabled",false);
                $("#N_acessos").attr("disabled",false)
            }
        });
    });
</script>
<script src="js/AE_HCM2000.js"></script>
<script src="js/AE_HCM2022.js"></script>
<script defer>
    $(['fhv','fhv_2022','vp','vp_2022','FFS_o','FFS_o_2022','c','c_2022','S','S_2022','D','D_2022','service_level','service_level_2022','label_fhv','label_vp','label_ffs','label_capacidade','label_velocidade_media','label_densidade','label_service_level']).each( function (key, el) {
        $('#'+el).on('change', function () {
            $(`input[type="hidden"][name="${el}"]`).val($(this).val() ?$(this).val() : $(this).text())
        })
    })

    $('#Calcular').click(function(e) {
        e.preventDefault();
        // HCM2000
        let car_volume = parseInt($('#car_volume').val());
        let N_acessos = parseInt($('#N_acessos').val());
        let phf = parseFloat($('#phf').val());
        let PT = parseInt($('#pt').val());
        let PR = parseInt($('#pr').val());
        let berma = parseFloat($('#berma').val());
        let via = parseFloat($('#via').val())
        let length = parseFloat($('#length').val());
        let N = parseInt($('#N_vias').val());
        let BFFS = parseFloat($('#BFFS').val());
        let ET = 0;
        let ER = 0;
        let fp = 0;
        let fhv = 0;
        let vp = 0;
        let FFS = 0;
        let S = 0;
        let D = 0;
        //HCM2022
        let ET_2022 = 0;
        let fhv_2022 = 0;
        let vp_2022 = 0;
        let FFS_2022 = 0;
        let FFSadj_2022 = 0;
        let c_2022 = 0;
        let cadj_2022 = 0;
        let CAF = 0;
        let SAF = 0;
        let BP = 0;
        let BPadj = 0;
        let S_2022 = 0;
        let D_2022 = 0;

        if ($('#ondulado').is(":checked")) {
            ET = 2.5
            ER = 2.0
            //HCM 2022
            ET_2022 = 3.0
        }else if ($('#plano').is(":checked")) {
            ET = 1.5;
            ER = 1.2;
            //HCM 2022
            ET_2022=2.0
        }else if ($('#montanhoso').is(":checked")) {
            ET = 4.5
            ER = 4.0;
            //HCM 2022
            ET_2022 = 3.0
        }

        fhv = f_hv(PT,ET,PR,ER); // Passo 2
        fhv_2022 = f_hv_2022(PT,ET_2022);


        $('#fhv').val(fhv.toFixed(3));
        $('#fhv_2022').val(fhv_2022.toFixed(3));

        if ($('#tipos_de_condutores').val()==="") {
            fp = 0.85
        }else {
            fp = 1.0
        }

        vp = v_p(car_volume,phf,N,fhv,fp); // Passo 3
        vp_2022 = v_p_2022(car_volume,phf,N,fhv_2022)

        $('#vp').val(vp.toFixed(1));
        $('#vp_2022').val(vp_2022.toFixed(1));

        if (vp<2400 || vp_2022<2400) {
            if ($('#FFS_m').is(":checked")) {
                FFS = parseFloat($('#FFS').val());
                $('#FFS_o').val(FFS.toFixed(1));
                $('#FFS_o_2022').val(FFS.toFixed(1));
                FFS_2022 = FFS;

            } else if ($('#FFS_c').is(":checked")) {
                //HCM2000
                let flw = 0; //via
                flw = f_lw(via);
                let flc = 0; //Nº vias e berma
                flc = f_lc(N,berma);
                let fn = 0;
                fn = f_n(N);
                let fid = 0;
                let TRD = N_acessos/length
                fid = f_id(TRD)
                FFS = FFS_f(BFFS,flw,flc,fn,fid)
                console.log(BFFS)
                console.log(flw)
                console.log(flc)
                console.log(fn)
                console.log(fid)
                $('#FFS_o').val(FFS.toFixed(1));
                //HCM2022
                let flw_2022 = 0;
                flw_2022 = f_lw_2022(via*(1/0.305)); //via
                console.log(flw_2022)
                let flrc = 0;
                flrc = f_rlc(N,berma*(1/0.305)) //N e berma
                console.log(flrc)
                let TRD_2022 = 0;
                TRD_2022=N_acessos/(length/1.61)
                console.log(TRD_2022)
                let FFS_2022_c=0;
                FFS_2022_c = FFS_f_2022(BFFS*(1/1.61),flw_2022,flrc,TRD_2022)
                console.log(FFS_2022_c)
                FFS_2022 = FFS_2022_c*1.61;
                console.log(FFS_2022)
                $('#FFS_o_2022').val((FFS_2022).toFixed(1))
            }

            if ((FFS_2022/1.61)>=55 && (FFS_2022/1.61)<60){
                if ($('#cond_atmos').val()==="Precipitação Média") {
                    CAF = 0.94;
                    SAF = 0,96;
                }else if  ($('#cond_atmos').val()==="Precipitação Elevada") {
                    CAF = 0.89;
                    SAF = 0.94;
                }else if  ($('#cond_atmos').val()==="Pouca Neve") {
                    CAF = 0.97;
                    SAF = 0.94;
                }else if  ($('#cond_atmos').val()==="Neve Ligeira") {
                    CAF = 0.95;
                    SAF = 0.92;
                }else if  ($('#cond_atmos').val()==="Muita Neve") {
                    CAF = 0.93;
                    SAF = 0.9;
                }else if  ($('#cond_atmos').val()==="Nevão") {
                    CAF = 0.8;
                    SAF = 0.88;

                }else if  ($('#cond_atmos').val()==="Frio Severo") {
                    CAF = 0.93;
                    SAF = 0.95;

                }else if  ($('#cond_atmos').val()==="Pouca visibilidade") {
                    CAF = 0.90;
                    SAF = 0.96;

                }else if  ($('#cond_atmos').val()==="Péssima Visibilidade") {
                    CAF = 0.88;
                    SAF = 0.95;

                }else if  ($('#cond_atmos').val()==="Visibilidade Minima") {
                    CAF = 0.90;
                    SAF = 0.95;

                }else{
                    CAF = 1.0;
                    SAF = 1.0;
                }

            }else if((FFS_2022/1.61)>=60 && (FFS_2022/1.61)<65){

                if ($('#cond_atmos').val()==="Precipitação Média") {
                    CAF = 0.93;
                    SAF = 0.95;
                }else if  ($('#cond_atmos').val()==="Precipitação Elevada") {
                    CAF = 0.88;
                    SAF = 0.93;

                }else if  ($('#cond_atmos').val()==="Pouca Neve") {
                    CAF = 0.96;
                    SAF = 0.92;

                }else if  ($('#cond_atmos').val()==="Neve Ligeira") {
                    CAF = 0.94
                    SAF = 0.9;

                }else if  ($('#cond_atmos').val()==="Muita Neve") {
                    CAF = 0.91;
                    SAF = 0.88;

                }else if  ($('#cond_atmos').val()==="Nevão") {
                    CAF = 0.78;
                    SAF = 0.86;

                }else if  ($('#cond_atmos').val()==="Frio Severo") {
                    CAF = 0.92;
                    SAF = 0.95;

                }else if  ($('#cond_atmos').val()==="Pouca visibilidade") {
                    CAF = 0.9;
                    SAF = 0.95;

                }else if  ($('#cond_atmos').val()==="Péssima Visibilidade") {
                    CAF = 0.88;
                    SAF = 0.94;

                }else if  ($('#cond_atmos').val()==="Visibilidade Minima") {
                    CAF = 0.9;
                    SAF = 0.94;

                }else{
                    CAF = 1.0;
                    SAF = 1.0;
                }
            }else if((FFS_2022/1.61)>=65 && (FFS_2022/1.61)<70){
                if ($('#cond_atmos').val()==="Precipitação Média") {
                    CAF = 0.92;
                    SAF = 0.94;
                    
                }else if  ($('#cond_atmos').val()==="Precipitação Elevada") {
                    CAF = 0.86;
                    SAF = 0.93;

                }else if  ($('#cond_atmos').val()==="Pouca Neve") {
                    CAF = 0.96;
                    SAF = 0.89;

                }else if  ($('#cond_atmos').val()==="Neve Ligeira") {
                    CAF = 0.92;
                    SAF = 0.88;

                }else if  ($('#cond_atmos').val()==="Muita Neve") {
                    CAF = 0.9;
                    SAF = 0.86;

                }else if  ($('#cond_atmos').val()==="Nevão") {
                    CAF = 0.76;
                    SAF = 0.85;

                }else if  ($('#cond_atmos').val()==="Frio Severo") {
                    CAF = 0.92;
                    SAF = 0.94;

                }else if  ($('#cond_atmos').val()==="Pouca visibilidade") {
                    CAF = 0.9;
                    SAF = 0.94;

                }else if  ($('#cond_atmos').val()==="Péssima Visibilidade") {
                    CAF = 0.88;
                    SAF = 0.93;

                }else if  ($('#cond_atmos').val()==="Visibilidade Minima") {
                    CAF = 0.9;
                    SAF = 0.93;

                }else{
                    CAF = 1.0;
                    SAF = 1.0;
                }
            
            }else if((FFS_2022/1.61)>=70 && (FFS_2022/1.61)<75){
                if ($('#cond_atmos').val()==="Precipitação Média") {
                    CAF = 0.91;
                    SAF = 0.93;
                    
                }else if  ($('#cond_atmos').val()==="Precipitação Elevada") {
                    CAF = 0.84;
                    SAF = 0.92;

                }else if  ($('#cond_atmos').val()==="Pouca Neve") {
                    CAF = 0.95;
                    SAF = 0.87;

                }else if  ($('#cond_atmos').val()==="Neve Ligeira") {
                    CAF = 0.9;
                    SAF = 0.86;

                }else if  ($('#cond_atmos').val()==="Muita Neve") {
                    CAF = 0.88;
                    SAF = 0.84;

                }else if  ($('#cond_atmos').val()==="Nevão") {
                    CAF = 0.74;
                    SAF = 0.83;

                }else if  ($('#cond_atmos').val()==="Frio Severo") {
                    CAF = 0.91;
                    SAF = 0.93;

                }else if  ($('#cond_atmos').val()==="Pouca visibilidade") {
                    CAF = 0.9;
                    SAF = 0.94;

                }else if  ($('#cond_atmos').val()==="Péssima Visibilidade") {
                    CAF = 0.88;
                    SAF = 0.92;

                }else if  ($('#cond_atmos').val()==="Visibilidade Minima") {
                    CAF = 0.9;
                    SAF = 0.92;

                }else{
                    CAF = 1.0;
                    SAF = 1.0;
                }
            }else if((FFS_2022/1.61)>=75){
                if ($('#cond_atmos').val()==="Precipitação Média") {
                    CAF = 0.9;
                    SAF = 0.93;
                    
                }else if  ($('#cond_atmos').val()==="Precipitação Elevada") {
                    CAF = 0.82;
                    SAF = 0.91;

                }else if  ($('#cond_atmos').val()==="Pouca Neve") {
                    CAF = 0.95;
                    SAF = 0.84;

                }else if  ($('#cond_atmos').val()==="Neve Ligeira") {
                    CAF = 0.88;
                    SAF = 0.83;

                }else if  ($('#cond_atmos').val()==="Muita Neve") {
                    CAF = 0.87;
                    SAF = 0.82;

                }else if  ($('#cond_atmos').val()==="Nevão") {
                    CAF = 0.72;
                    SAF = 0.81;

                }else if  ($('#cond_atmos').val()==="Frio Severo") {
                    CAF = 0.9;
                    SAF = 0.92;

                }else if  ($('#cond_atmos').val()==="Pouca visibilidade") {
                    CAF = 0.9;
                    SAF = 0.93;

                }else if  ($('#cond_atmos').val()==="Péssima Visibilidade") {
                    CAF = 0.88;
                    SAF = 0.91;

                }else if  ($('#cond_atmos').val()==="Visibilidade Minima") {
                    CAF = 0.9;
                    SAF = 0.91;

                }else{
                    CAF = 1.0;
                    SAF = 1.0;
                }
            }
            c_2022 = c_f(FFS_2022/1.61);
            $('#c_2022').val(c_2022.toFixed(0));
            if (c_2022>2400){
                $('#S_2022').val('');
                $('#D_2022').val('');
                $('#FFS_o_2022').val('');
                $('#service_level_2022').val("F");
            }else{
                FFSadj=FFSadj_f(FFS_2022/1.61,SAF); //mi/h
                cadj_2022 = cadj_f(c_2022,CAF);
                BP=BP_f(FFS_2022/1.61,CAF);
                BPadj=BPadj_f(FFSadj,CAF);
                S_2022 = S_f_2022(FFSadj,vp,BPadj,c_2022,cadj_2022);
                $('#S_2022').val((S_2022*1.61).toFixed(1));
                D_2022 = D_f(vp_2022,S_2022); 
                $('#D_2022').val((D_2022/1.61).toFixed(1));
                $('#service_level_2022').val(LOS_2022(D_2022));
            }
            $('#c').val(2400);
            S = S_f(FFS,vp);
            $('#S').val(S.toFixed(1));
            D = D_f(vp,S);
            $('#D').val(D.toFixed(1));
            $('#service_level').val(LOS(D));
        }else {
            $('#c').val(2400);
            $('#S').val('');
            $('#D').val('');
            $('#FFS_o').val('');
            $('#service_level').val("F");
            $('#S_2022').val('');
            $('#D_2022').val('');
            $('#FFS_o_2022').val('');
            $('#service_level_2022').val("F");
        }
        // HCM 7ªEdição
        
            // $('#service_level').val(vp.toFixed());

        $(['fhv','fhv_2022','vp','vp_2022','FFS_o','FFS_o_2022','c','c_2022','S','S_2022','D','D_2022','service_level','service_level_2022','label_fhv','label_vp','label_ffs','label_capacidade','label_velocidade_media','label_densidade','label_service_level']).each( function (key, el) {
            $('#'+el).change();
        })
    })
  //   $("#Exportar").click(function() {
  //   // Obtenha os dados do formulário
  //   var formData = $('#Outputs').serializeArray();
  //
  //   // Obtenha os dados da tabela
  //   var tableData = [];
  //   $('#tabela tbody tr').each(function() {
  //     var rowData = [];
  //     $(this).find('td').each(function() {
  //       rowData.push($(this).text());
  //     });
  //     tableData.push(rowData);
  //   });
  //
  //   // Crie o objeto de workbook
  //   var wb = XLSX.utils.book_new();
  //
  //   // Crie uma worksheet para os dados do formulário
  //   var formDataSheet = XLSX.utils.json_to_sheet(formData);
  //   XLSX.utils.book_append_sheet(wb, formDataSheet, 'Formulário');
  //
  //   // Crie uma worksheet para os dados da tabela
  //   var tableDataSheet = XLSX.utils.aoa_to_sheet(tableData);
  //   XLSX.utils.book_append_sheet(wb, tableDataSheet, 'Tabela');
  //
  //   // Salve o arquivo XLSX
  //   var fileName = 'dados.xlsx';
  //   XLSX.writeFile(wb, fileName);
  // });
</script>
</html>